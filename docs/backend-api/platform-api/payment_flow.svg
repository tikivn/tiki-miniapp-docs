<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1271px" preserveAspectRatio="none" style="width:1101px;height:1271px;background:#FFFFFF;" version="1.1" viewBox="0 0 1101 1271" width="1101px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xhstj10yc7dm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="204" x="445" y="28.708">Tiniapp Payment Flow</text><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="782.8516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="207.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="144.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="439.5" y="208.5156"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="143.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="679.5" y="382.3125"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="679.5" y="555.375"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="850" y="294.9141"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="83.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="850" y="745.3047"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="850" y="1073.2891"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1045" y="584.5078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="123.25" y2="1187.5547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="212.5" x2="212.5" y1="123.25" y2="1187.5547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="444.5" x2="444.5" y1="123.25" y2="1187.5547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="684.5" x2="684.5" y1="123.25" y2="1187.5547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="854.5" x2="854.5" y1="123.25" y2="1187.5547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1050" x2="1050" y1="123.25" y2="1187.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="119.9482">User</text><ellipse cx="23.5" cy="49.9531" fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,57.9531 L23.5,84.9531 M10.5,65.9531 L36.5,65.9531 M23.5,84.9531 L10.5,99.9531 M23.5,84.9531 L36.5,99.9531 " fill="none" filter="url(#f1xhstj10yc7dm)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="1199.5498">User</text><ellipse cx="23.5" cy="1212.8516" fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,1220.8516 L23.5,1247.8516 M10.5,1228.8516 L36.5,1228.8516 M23.5,1247.8516 L10.5,1262.8516 M23.5,1247.8516 L36.5,1262.8516 " fill="none" filter="url(#f1xhstj10yc7dm)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="102" x="159.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="166.5" y="107.9482">Partner App</text><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="102" x="159.5" y="1186.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="166.5" y="1206.5498">Partner App</text><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="134" x="375.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="382.5" y="107.9482">Partner Backend</text><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="134" x="375.5" y="1186.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="382.5" y="1206.5498">Partner Backend</text><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="152" x="606.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="613.5" y="107.9482">Tiniapp Framework</text><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="152" x="606.5" y="1186.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="613.5" y="1206.5498">Tiniapp Framework</text><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="161" x="772.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="779.5" y="107.9482">Tiniapp API Backend</text><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="161" x="772.5" y="1186.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="779.5" y="1206.5498">Tiniapp API Backend</text><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="74" x="1011" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1018" y="107.9482">Tiki App</text><rect fill="#FEFECE" filter="url(#f1xhstj10yc7dm)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="74" x="1011" y="1186.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="1018" y="1206.5498">Tiki App</text><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="782.8516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="207.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="144.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="439.5" y="208.5156"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="143.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="679.5" y="382.3125"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="679.5" y="555.375"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="850" y="294.9141"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="83.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="850" y="745.3047"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="850" y="1073.2891"/><rect fill="#FFFFFF" filter="url(#f1xhstj10yc7dm)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1045" y="584.5078"/><polygon fill="#A80036" points="195.5,175.3828,205.5,179.3828,195.5,183.3828,199.5,179.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="201.5" y1="179.3828" y2="179.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="30.5" y="174.3169">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="43.5" y="174.3169">place order</text><polygon fill="#A80036" points="427.5,204.5156,437.5,208.5156,427.5,212.5156,431.5,208.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="217.5" x2="433.5" y1="208.5156" y2="208.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="224.5" y="203.4497">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="237.5" y="203.4497">create order</text><line style="stroke:#A80036;stroke-width:1.0;" x1="449.5" x2="491.5" y1="237.6484" y2="237.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="491.5" x2="491.5" y1="237.6484" y2="250.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="450.5" x2="491.5" y1="250.6484" y2="250.6484"/><polygon fill="#A80036" points="460.5,246.6484,450.5,250.6484,460.5,254.6484,456.5,250.6484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8" x="456.5" y="232.5825">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="468.5" y="232.5825">create internal order</text><polygon fill="#A80036" points="838,290.9141,848,294.9141,838,298.9141,842,294.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="449.5" x2="844" y1="294.9141" y2="294.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="456.5" y="282.2817">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="469.5" y="274.7153">create tiki order (signed with secret)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="469.5" y="289.8481">POST /order</text><polygon fill="#A80036" points="460.5,320.0469,450.5,324.0469,460.5,328.0469,456.5,324.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="454.5" x2="854" y1="324.0469" y2="324.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="466.5" y="318.981">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="479.5" y="318.981">return new tiki order</text><polygon fill="#A80036" points="228.5,349.1797,218.5,353.1797,228.5,357.1797,224.5,353.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="222.5" x2="443.5" y1="353.1797" y2="353.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="234.5" y="348.1138">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="247.5" y="348.1138">return order</text><polygon fill="#A80036" points="667.5,378.3125,677.5,382.3125,667.5,386.3125,671.5,382.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="217.5" x2="673.5" y1="382.3125" y2="382.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="224.5" y="377.2466">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="237.5" y="377.2466">call my.MakePayment</text><path d="M579,395.3125 L579,495.3125 L785,495.3125 L785,405.3125 L775,395.3125 L579,395.3125 " fill="#FBFB77" filter="url(#f1xhstj10yc7dm)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M775,395.3125 L775,405.3125 L785,405.3125 L775,395.3125 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="585" y="412.3794">params</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="585" y="427.5122">+ tiki_order_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="585" y="442.645">+ success callback function</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="585" y="457.7778">+ fail callback function</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="585" y="472.9106">+ complete callback function</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="589" y="488.0435"/><polygon fill="#A80036" points="34.5,522.2422,24.5,526.2422,34.5,530.2422,30.5,526.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="683.5" y1="526.2422" y2="526.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="40.5" y="521.1763">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="53.5" y="521.1763">take user to the payment screen</text><polygon fill="#A80036" points="667.5,551.375,677.5,555.375,667.5,559.375,671.5,555.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="673.5" y1="555.375" y2="555.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="30.5" y="550.3091">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="43.5" y="550.3091">follow payment process</text><polygon fill="#A80036" points="1033,580.5078,1043,584.5078,1033,588.5078,1037,584.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="689.5" x2="1039" y1="584.5078" y2="584.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="696.5" y="579.4419">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="719.5" y="579.4419">follow payment process</text><polygon fill="#A80036" points="700.5,609.6406,690.5,613.6406,700.5,617.6406,696.5,613.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="694.5" x2="1049" y1="613.6406" y2="613.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="706.5" y="608.5747">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="728.5" y="608.5747">payment success</text><polygon fill="#A80036" points="228.5,638.7734,218.5,642.7734,228.5,646.7734,224.5,642.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="222.5" x2="683.5" y1="642.7734" y2="642.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="234.5" y="637.7075">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="416" x="256.5" y="637.7075">execute the callback function depend on payment process result</text><polygon fill="#A80036" points="34.5,667.9063,24.5,671.9063,34.5,675.9063,30.5,671.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="206.5" y1="671.9063" y2="671.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="40.5" y="666.8403">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="61.5" y="666.8403">display waiting page</text><polygon fill="#A80036" points="432.5,697.0391,442.5,701.0391,432.5,705.0391,436.5,701.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="217.5" x2="438.5" y1="701.0391" y2="701.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="224.5" y="695.9731">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="246.5" y="695.9731">polling to check order status</text><polygon fill="#A80036" points="838,741.3047,848,745.3047,838,749.3047,842,745.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="444.5" x2="844" y1="745.3047" y2="745.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="451.5" y="732.6724">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="473.5" y="725.106">get tiki order (signed with secret)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="473.5" y="740.2388">GET /order</text><path d="M386,758.3047 L386,798.3047 L498,798.3047 L498,768.3047 L488,758.3047 L386,758.3047 " fill="#FBFB77" filter="url(#f1xhstj10yc7dm)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M488,758.3047 L488,768.3047 L498,768.3047 L488,758.3047 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="392" y="775.3716">params</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="392" y="790.5044">+ tiki_order_id</text><polygon fill="#A80036" points="455.5,824.7031,445.5,828.7031,455.5,832.7031,451.5,828.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="449.5" x2="854" y1="828.7031" y2="828.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="461.5" y="823.6372">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="483.5" y="823.6372">return new tiki order</text><polygon fill="#A80036" points="455.5,853.8359,445.5,857.8359,455.5,861.8359,451.5,857.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="449.5" x2="854" y1="857.8359" y2="857.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="461.5" y="852.77">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="483.5" y="852.77">notify payment status</text><polygon fill="#A80036" points="228.5,882.9688,218.5,886.9688,228.5,890.9688,224.5,886.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="222.5" x2="443.5" y1="886.9688" y2="886.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="234.5" y="881.9028">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="256.5" y="881.9028">order paid</text><polygon fill="#A80036" points="34.5,912.1016,24.5,916.1016,34.5,920.1016,30.5,916.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="211.5" y1="916.1016" y2="916.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="40.5" y="911.0356">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="62.5" y="911.0356">show thank you page</text><rect fill="#EEEEEE" filter="url(#f1xhstj10yc7dm)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1094" x="0" y="971.9961"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1094" y1="971.9961" y2="971.9961"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1094" y1="974.9961" y2="974.9961"/><rect fill="#EEEEEE" filter="url(#f1xhstj10yc7dm)" height="27.7891" style="stroke:#000000;stroke-width:2.0;" width="237" x="428.5" y="959.1016"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="223" x="434.5" y="978.8813">Order Delivery Update</text><polygon fill="#A80036" points="838,1069.2891,848,1073.2891,838,1077.2891,842,1073.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="444.5" x2="844" y1="1073.2891" y2="1073.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="451.5" y="1053.0903">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="474.5" y="1037.9575">update delivery status</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="474.5" y="1053.0903">POST /order/complete</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="474.5" y="1068.2231">POST /order/cancel</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="860" x2="902" y1="1102.4219" y2="1102.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="902" x2="902" y1="1102.4219" y2="1115.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="861" x2="902" y1="1115.4219" y2="1115.4219"/><polygon fill="#A80036" points="871,1111.4219,861,1115.4219,871,1119.4219,867,1115.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="867" y="1097.356">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="889" y="1097.356">update tiki order status</text><polygon fill="#A80036" points="455.5,1140.5547,445.5,1144.5547,455.5,1148.5547,451.5,1144.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="449.5" x2="854" y1="1144.5547" y2="1144.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="461.5" y="1139.4888">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="483.5" y="1139.4888">updated</text><!--MD5=[014afd4561cdc250f957cc477d7b2a65]
@startuml
title "Tiniapp Payment Flow"
autonumber

actor "User" as U
participant "Partner App" as MA
participant "Partner Backend" as MABE
participant "Tiniapp Framework" as PM
participant "Tiniapp API Backend" as TC
participant "Tiki App" as PP

|||
activate MA
U -> MA: place order
MA -> MABE: create order
activate MABE
MABE -> MABE: create internal order
MABE -> TC: create tiki order (signed with secret)\nPOST /order
activate TC
TC - -> MABE: return new tiki order
deactivate TC
MABE - -> MA: return order
deactivate MABE

MA - -> PM: call my.MakePayment
activate PM
note over PM
    params
    + tiki_order_id
    + success callback function
    + fail callback function
    + complete callback function

end note
PM - -> U: take user to the payment screen
deactivate PM

U -> PM: follow payment process
activate PM
PM -> PP: follow payment process
activate PP
PP - -> PM: payment success
deactivate PP
PM - -> MA: execute the callback function depend on payment process result
deactivate PM

MA - -> U: display waiting page
MA -> MABE: polling to check order status
MABE -> TC: get tiki order (signed with secret)\nGET /order
activate TC
note over MABE
    params
    + tiki_order_id
end note
TC - -> MABE: return new tiki order
deactivate TC

TC - -> MABE: notify payment status
MABE - -> MA: order paid
MA - -> U: show thank you page
deactivate MA

|||
=== Order Delivery Update ==
|||
MABE -> TC: update delivery status \nPOST /order/complete \nPOST /order/cancel
activate TC
TC - -> TC: update tiki order status
TC - -> MABE: updated
deactivate TC

|||
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>