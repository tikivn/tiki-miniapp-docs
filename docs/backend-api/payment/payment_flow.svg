<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1185px" preserveAspectRatio="none" style="width:1077px;height:1185px;background:#FFFFFF;" version="1.1" viewBox="0 0 1077 1185" width="1077px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="182" x="443.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="172" x="448.5" y="27.9951">Tiniapp Payment Flow</text><rect fill="#FFFFFF" height="734.7188" style="stroke:#181818;stroke-width:1.0;" width="10" x="205" y="128.5938"/><rect fill="#FFFFFF" height="144.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="437" y="178.8594"/><rect fill="#FFFFFF" height="124.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="674" y="352.6563"/><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="674" y="506.5859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="265.2578"/><rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="696.5156"/><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="1015.8438"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1028" y="535.7188"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="24" x2="24" y1="118.5938" y2="1105.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="209.5" x2="209.5" y1="118.5938" y2="1105.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="441.5" x2="441.5" y1="118.5938" y2="1105.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="679" x2="679" y1="118.5938" y2="1105.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="838" x2="838" y1="118.5938" y2="1105.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1033" x2="1033" y1="118.5938" y2="1105.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="5" y="115.292">User</text><ellipse cx="24" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M24,58.7969 L24,85.7969 M11,66.7969 L37,66.7969 M24,85.7969 L11,100.7969 M24,85.7969 L37,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="5" y="1117.1045">User</text><ellipse cx="24" cy="1128.9063" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M24,1136.9063 L24,1163.9063 M11,1144.9063 L37,1144.9063 M24,1163.9063 L11,1178.9063 M24,1163.9063 L37,1178.9063 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="162.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="169.5" y="107.292">Partner App</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="162.5" y="1104.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="169.5" y="1124.1045">Partner App</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129" x="377.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="384.5" y="107.292">Partner Backend</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129" x="377.5" y="1104.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="384.5" y="1124.1045">Partner Backend</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144" x="607" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="614" y="107.292">Tiniapp Framework</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144" x="607" y="1104.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="614" y="1124.1045">Tiniapp Framework</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="154" x="761" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="768" y="107.292">Tiniapp API Backend</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="154" x="761" y="1104.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="768" y="1124.1045">Tiniapp API Backend</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="64" x="1001" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="1008" y="107.292">TikiApp</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="64" x="1001" y="1104.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="1008" y="1124.1045">TikiApp</text><rect fill="#FFFFFF" height="734.7188" style="stroke:#181818;stroke-width:1.0;" width="10" x="205" y="128.5938"/><rect fill="#FFFFFF" height="144.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="437" y="178.8594"/><rect fill="#FFFFFF" height="124.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="674" y="352.6563"/><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="674" y="506.5859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="265.2578"/><rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="696.5156"/><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="1015.8438"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1028" y="535.7188"/><polygon fill="#181818" points="193,145.7266,203,149.7266,193,153.7266,197,149.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="24" x2="199" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="31" y="144.6606">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="44" y="144.6606">place order</text><polygon fill="#181818" points="425,174.8594,435,178.8594,425,182.8594,429,178.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="215" x2="431" y1="178.8594" y2="178.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="222" y="173.7935">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="235" y="173.7935">create order</text><line style="stroke:#181818;stroke-width:1.0;" x1="447" x2="489" y1="207.9922" y2="207.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="489" x2="489" y1="207.9922" y2="220.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="448" x2="489" y1="220.9922" y2="220.9922"/><polygon fill="#181818" points="458,216.9922,448,220.9922,458,224.9922,454,220.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="454" y="202.9263">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="467" y="202.9263">create internal order</text><polygon fill="#181818" points="821,261.2578,831,265.2578,821,269.2578,825,265.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="447" x2="827" y1="265.2578" y2="265.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="454" y="252.6255">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="467" y="245.0591">create tiki order (signed with secret)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="467" y="260.1919">POST /order</text><polygon fill="#181818" points="458,290.3906,448,294.3906,458,298.3906,454,294.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="452" x2="837" y1="294.3906" y2="294.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="464" y="289.3247">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="477" y="289.3247">return new tiki order</text><polygon fill="#181818" points="226,319.5234,216,323.5234,226,327.5234,222,323.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="220" x2="441" y1="323.5234" y2="323.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="232" y="318.4575">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="245" y="318.4575">return order</text><polygon fill="#181818" points="662,348.6563,672,352.6563,662,356.6563,666,352.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="215" x2="668" y1="352.6563" y2="352.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="222" y="347.5903">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="235" y="347.5903">call my.MakePayment</text><path d="M521,365.6563 L521,450.6563 L836,450.6563 L836,375.6563 L826,365.6563 L521,365.6563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M826,365.6563 L826,375.6563 L836,375.6563 L826,365.6563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="527" y="382.7231">params</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="527" y="397.856">+ order_id (field id of tiki order response data)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="527" y="412.9888">+ success callback function</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="527" y="428.1216">+ fail callback function</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="527" y="443.2544">+ complete callback function</text><polygon fill="#181818" points="35,473.4531,25,477.4531,35,481.4531,31,477.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="29" x2="678" y1="477.4531" y2="477.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="41" y="472.3872">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="54" y="472.3872">take user to the payment screen</text><polygon fill="#181818" points="662,502.5859,672,506.5859,662,510.5859,666,506.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="24" x2="668" y1="506.5859" y2="506.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="31" y="501.52">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="44" y="501.52">follow payment process</text><polygon fill="#181818" points="1016,531.7188,1026,535.7188,1016,539.7188,1020,535.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="684" x2="1022" y1="535.7188" y2="535.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="691" y="530.6528">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="713" y="530.6528">follow payment process</text><polygon fill="#181818" points="695,560.8516,685,564.8516,695,568.8516,691,564.8516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="689" x2="1032" y1="564.8516" y2="564.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="701" y="559.7856">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="723" y="559.7856">payment success</text><polygon fill="#181818" points="226,589.9844,216,593.9844,226,597.9844,222,593.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="220" x2="678" y1="593.9844" y2="593.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="232" y="588.9185">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="413" x="254" y="588.9185">execute the callback function depend on payment process result</text><polygon fill="#181818" points="35,619.1172,25,623.1172,35,627.1172,31,623.1172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="29" x2="204" y1="623.1172" y2="623.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="41" y="618.0513">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="63" y="618.0513">display waiting page</text><polygon fill="#181818" points="430,648.25,440,652.25,430,656.25,434,652.25" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="215" x2="436" y1="652.25" y2="652.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="222" y="647.1841">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="244" y="647.1841">polling to check order status</text><polygon fill="#181818" points="821,692.5156,831,696.5156,821,700.5156,825,696.5156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="442" x2="827" y1="696.5156" y2="696.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="449" y="683.8833">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="471" y="676.3169">get order (signed with secret)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="471" y="691.4497">GET /order</text><path d="M282,709.5156 L282,749.5156 L602,749.5156 L602,719.5156 L592,709.5156 L282,709.5156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M592,709.5156 L592,719.5156 L602,719.5156 L592,709.5156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="288" y="726.5825">params</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="288" y="741.7153">+ order_id (same as order id is used at step 7)</text><polygon fill="#181818" points="453,771.9141,443,775.9141,453,779.9141,449,775.9141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="447" x2="837" y1="775.9141" y2="775.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="459" y="770.8481">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="481" y="770.8481">return order</text><polygon fill="#181818" points="453,801.0469,443,805.0469,453,809.0469,449,805.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="447" x2="837" y1="805.0469" y2="805.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="459" y="799.981">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="481" y="799.981">notify payment status</text><polygon fill="#181818" points="226,830.1797,216,834.1797,226,838.1797,222,834.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="220" x2="441" y1="834.1797" y2="834.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="232" y="829.1138">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="254" y="829.1138">order paid</text><polygon fill="#181818" points="35,859.3125,25,863.3125,35,867.3125,31,863.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="29" x2="209" y1="863.3125" y2="863.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="41" y="858.2466">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="63" y="858.2466">show thank you page</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1070" x="0" y="916.8789"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1070" y1="916.8789" y2="916.8789"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1070" y1="919.8789" y2="919.8789"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="184" x="443" y="906.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="165" x="449" y="922.3794">Order Delivery Update</text><polygon fill="#181818" points="821,1011.8438,831,1015.8438,821,1019.8438,825,1015.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="442" x2="827" y1="1015.8438" y2="1015.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="449" y="995.645">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="471" y="980.5122">update delivery status</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="471" y="995.645">POST /order/complete</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="471" y="1010.7778">POST /order/cancel</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="843" x2="885" y1="1044.9766" y2="1044.9766"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="885" x2="885" y1="1044.9766" y2="1057.9766"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="844" x2="885" y1="1057.9766" y2="1057.9766"/><polygon fill="#181818" points="854,1053.9766,844,1057.9766,854,1061.9766,850,1057.9766" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="850" y="1039.9106">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="872" y="1039.9106">update tiki order status</text><polygon fill="#181818" points="453,1083.1094,443,1087.1094,453,1091.1094,449,1087.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="447" x2="837" y1="1087.1094" y2="1087.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="459" y="1082.0435">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="481" y="1082.0435">updated</text><!--MD5=[89e066c18cc91fe1a224f63ba78e1346]
@startuml
title "Tiniapp Payment Flow"
autonumber

Actor "User" as U
participant "Partner App" as PA
participant "Partner Backend" as PB
participant "Tiniapp Framework" as TF
participant "Tiniapp API Backend" as TB
participant "TikiApp" as TK

activate PA
U -> PA: place order
PA -> PB: create order
activate PB
PB -> PB: create internal order
PB -> TB: create tiki order (signed with secret)\nPOST /order
activate TB
TB - -> PB: return new tiki order
deactivate TB
PB - -> PA: return order
deactivate PB
PA - -> TF: call my.MakePayment
activate TF
note over TF
 params
 + order_id (field id of tiki order response data)
 + success callback function
 + fail callback function
 + complete callback function
end note
TF - -> U: take user to the payment screen
deactivate TF
U -> TF: follow payment process
activate TF
TF -> TK: follow payment process
activate TK
TK - -> TF: payment success
deactivate TK
TF - -> PA: execute the callback function depend on payment process result
deactivate TF
PA - -> U: display waiting page
PA -> PB: polling to check order status
PB -> TB: get order (signed with secret)\nGET /order
activate TB
note over PB
 params
 + order_id (same as order id is used at step 7)
end note
TB - -> PB: return order
deactivate TB
TB - -> PB: notify payment status
PB - -> PA: order paid
PA - -> U: show thank you page
deactivate PA

|||
== Order Delivery Update ==
|||
PB -> TB: update delivery status\nPOST /order/complete\nPOST /order/cancel
activate TB
TB - -> TB: update tiki order status
TB - -> PB: updated
deactivate TB
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>
